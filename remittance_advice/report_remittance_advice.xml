<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

<template id="report_remittance_advice_document">
    <t t-call="report.external_layout">
        <div class="page">
            <div class="row">
                <div id="partner-address-block" class="col-xs-5 col-xs-offset-7">
                    <address
                        id="partner-address-field"
                        t-field="o.partner_id"
                        t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'
                    />
                    <span id="partner-address-vat-field"
                          t-field="o.partner_id.vat"
                    />
                </div>
            </div>
            <h2 id="main-heading">
                <t t-if="o.state == 'draft'">DRAFT Payment</t>
                <t t-if="o.state == 'cancel'">CANCELLED Payment</t>
                <t t-if="o.state == 'proforma'">PRO-FORMA Payment</t>
                <t t-if="o.state == 'posted'">
                    <t t-if="o.type == 'payment'"> REMITTANCE ADVICE </t>
                    <t t-if="o.type != 'payment'"> RECEIPT OF PAYMENT </t>
                </t>
                <t t-if="o.number"> #: <span t-field="o.number"/></t>
            </h2>
            <div class="row mt32 mb32">
                <div class="col-xs-3" t-if="o.name">
                    <strong>Memo:</strong>
                    <p t-field="o.name"/>
                </div>
            </div>
            <t  t-set="lines"
                t-value="o.line_dr_ids if o.type == 'payment' else o.line_cr_ids"
            />
            <t  t-set="display_lines"
                t-value="filter(lambda l: l.amount != 0, lines)"
            />
            <table id="lines-table" class="table table-condensed">
                <thead>
                    <th id="lines-colhd-item">Item</th>
                    <th id="lines-colhd-date">Date</th>
                    <th id="lines-colhd-orig-amt">Original Amount</th>
                    <th id="lines-colhd-amt-paid">Amount Paid</th>
                </thead>
                <tbody class="invoice_tbody">
                    <tr t-foreach="display_lines" t-as='l'>
                        <td id="lines-cell-item">
                            <span t-field="l.move_line_id"/>
                        </td>
                        <td id="lines-cell-date">
                            <span t-field="l.date_original"/>
                        </td>
                        <td id="lines-cell-orig-amt">
                            <span t-field="l.amount_original"/>
                        </td>
                        <td id="lines-cell-amt-paid">
                            <span t-field="l.amount"/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </t>
</template>
<template id="report_remittance_advice">
    <t t-call="report.html_container">
        <t t-foreach="doc_ids" t-as="doc_id">
            <t t-raw="translate_doc(doc_id, doc_model, 'partner_id.lang', 'remittance_advice.report_remittance_advice_document')"/>
        </t>
    </t>
</template>

<report 
    id="remittance_advices"
    model="account.voucher"
    string="Remittance Advice"
    report_type="qweb-pdf"
    name="remittance_advice.report_remittance_advice"
    file="remittance_advice.report_remittance_advice"
    attachment_use="True"
    attachment="(object.state in ('open','paid')) and ('REMITTANCE'+(object.number or '').replace('/','')+'.pdf')"
/>

</data>
</openerp>
